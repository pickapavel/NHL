<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>ELH ‚Äì Sez√≥na 01</title>
<style>
body{margin:0;font-family:Arial;background:#f4f4f4}
nav{background:#1fa9e0}
nav .menu{max-width:1200px;margin:0 auto;display:flex;gap:20px;padding:12px 20px}
nav a{color:white;text-decoration:none;font-weight:bold;padding:6px 12px;border-radius:4px}
nav a.active{background:white;color:#1fa9e0}
.wrapper{max-width:1200px;margin:0 auto;background:white;min-height:100vh;padding:20px}
table{border-collapse:collapse;width:100%;margin-bottom:30px}
th,td{border:1px solid #999;padding:4px 6px;text-align:center}
th{background:#1fa9e0;color:white}
td.team{text-align:left;width:260px}
td.logo{width:34px}
td.logo img{width:26px;height:26px;object-fit:contain}
.hidden{display:none}
</style>
</head>
<body>

<nav>
<div class="menu">
<a href="index.html" class="active">Extraliga</a>
<a href="#">Mistrovstv√≠ svƒõta</a>
<a href="#">Olympijsk√Ω turnaj</a>
<a href="#">Svƒõtov√Ω poh√°r</a>
</div>
</nav>

<div class="wrapper">

<h1>ELH ‚Äì Sez√≥na 01</h1>

<table>
<thead>
<tr>
<th></th><th>#</th><th>T√Ωm</th><th>B</th><th>Sk√≥re</th><th>+/-</th>
<th>Z</th><th>V</th><th>P</th><th>VP</th><th>PP</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

<h2>Admin ‚Äì z√°pis v√Ωsledku</h2>
<div id="loginBox">
Heslo: <input type="password" id="password">
<button id="loginBtn">P≈ôihl√°sit</button>
<button id="rebuildBtn">üîÑ P≈ôepoƒç√≠tat tabulku</button>
</div>

<form id="matchForm" class="hidden">
Dom√°c√≠:
<select id="home"></select>
Host√©:
<select id="away"></select><br><br>
G√≥ly dom√°c√≠: <input type="number" id="hg" min="0" required>
G√≥ly host√©: <input type="number" id="ag" min="0" required><br><br>
Typ:
<select id="type">
<option value="normal">Z√°kladn√≠ doba</option>
<option value="pp">Prodlou≈æen√≠ / n√°jezdy</option>
</select><br><br>
<button type="submit">Ulo≈æit v√Ωsledek</button>
</form>

<h2>Historie z√°pas≈Ø</h2>
<table>
<thead>
<tr>
<th>Datum</th><th>Dom√°c√≠</th><th>Sk√≥re</th><th>Host√©</th><th>Typ</th>
</tr>
</thead>
<tbody id="matchesBody"></tbody>
</table>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, onValue, push, get, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const ADMIN_PASSWORD="Lokomotiva";

const firebaseConfig = {
  apiKey: "AIzaSyDXjPNrMB-NEjf_wyx0HsIBM8Qe-h4Y2Rg",
  authDomain: "elh---blbouni.firebaseapp.com",
  databaseURL: "https://elh---blbouni-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "elh---blbouni",
  storageBucket: "elh---blbouni.appspot.com",
  messagingSenderId: "768832575710",
  appId: "1:768832575710:web:41deeb7440abe1e6f0ca4f"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const logos = {
 "HC Chemopetrol Litv√≠nov":"logos/litvinov.png",
 "HC Dynamo Pardubice":"logos/pardubice.png",
 "HC Sparta Praha":"logos/sparta.png",
 "HC Geus Okna Kladno":"logos/kladno.png",
 "HC Ocel√°≈ôi T≈ôinec":"logos/trinec.png",
 "HC B√Ωl√≠ Tyg≈ôi Liberec":"logos/liberec.png",
 "HC Energie Karlovy Vary":"logos/vary.png",
 "HC Mounfield ƒåesk√© Budƒõjovice":"logos/budejovice.png"
};

const teams = Object.keys(logos);
home.innerHTML = away.innerHTML = teams.map(t=>`<option>${t}</option>`).join("");

loginBtn.onclick=()=>{
 if(password.value===ADMIN_PASSWORD){
  loginBox.classList.add("hidden");
  matchForm.classList.remove("hidden");
 } else alert("≈†patn√© heslo");
};

matchForm.onsubmit = async e => {
 e.preventDefault();
 await push(ref(db,"sezona01/matches"),{
  home:home.value, away:away.value,
  hg:+hg.value, ag:+ag.value,
  type:type.value, time:Date.now()
 });
 matchForm.reset();
};

rebuildBtn.onclick = async () => {
 const snap = await get(ref(db,"sezona01/matches"));
 const matches = Object.values(snap.val()||{});
 const table = {};
 const base = n => table[n] ||= {name:n,B:0,Z:0,V:0,P:0,VP:0,PP:0,GF:0,GA:0};

 matches.forEach(m=>{
  const h=base(m.home), a=base(m.away);
  h.Z++; a.Z++;
  h.GF+=m.hg; h.GA+=m.ag;
  a.GF+=m.ag; a.GA+=m.hg;

  if(m.hg>m.ag){
   if(m.type==="pp"){h.VP++;h.B+=2;a.PP++;a.B+=1}
   else{h.V++;h.B+=3;a.P++}
  } else {
   if(m.type==="pp"){a.VP++;a.B+=2;h.PP++;h.B+=1}
   else{a.V++;a.B+=3;h.P++}
  }
 });

 await set(ref(db,"sezona01/table"),table);
 alert("Tabulka p≈ôepoƒç√≠t√°na z historie z√°pas≈Ø");
};

function renderTable(data){
 tableBody.innerHTML="";
 if(!data) return;
 Object.values(data)
 .sort((a,b)=>b.B-a.B||((b.GF-b.GA)-(a.GF-a.GA)))
 .forEach((t,i)=>{
  tableBody.innerHTML+=`
  <tr>
   <td class="logo"><img src="${logos[t.name]||""}"></td>
   <td>${i+1}</td>
   <td class="team">${t.name}</td>
   <td>${t.B}</td>
   <td>${t.GF}:${t.GA}</td>
   <td>${t.GF-t.GA}</td>
   <td>${t.Z}</td>
   <td>${t.V}</td>
   <td>${t.P}</td>
   <td>${t.VP}</td>
   <td>${t.PP}</td>
  </tr>`;
 });
}

function renderMatches(data){
 matchesBody.innerHTML="";
 if(!data) return;
 Object.values(data).sort((a,b)=>b.time-a.time).forEach(m=>{
  matchesBody.innerHTML+=`
  <tr>
   <td>${new Date(m.time).toLocaleDateString()}</td>
   <td>${m.home}</td>
   <td><strong>${m.hg}:${m.ag}</strong></td>
   <td>${m.away}</td>
   <td>${m.type==="pp"?"PP/N":"ZD"}</td>
  </tr>`;
 });
}

onValue(ref(db,"sezona01/table"),s=>renderTable(s.val()));
onValue(ref(db,"sezona01/matches"),s=>renderMatches(s.val()));
</script>

</body>
</html>
