<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Statistiky týmů</title>

<style>

*{box-sizing:border-box}

body{
    font-family:Arial;
    background:#f2f2f2;
    margin:0;
}

.wrapper{
    max-width:1200px;
    margin:auto;
    padding:20px;
    background:white;
}

.controls{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    margin-bottom:20px;
}

.controls > *{
    flex:1;
    min-width:160px;
    padding:8px;
}

.tableWrap{
    overflow-x:auto;
}

table{
    border-collapse:collapse;
    width:100%;
    min-width:650px;
}

th{
    border:1px solid #999;
    padding:8px;
    text-align:center;
    background:black;
    color:#ffff00;
}

td{
    border:1px solid #999;
    padding:8px;
    text-align:center;
}

.summaryRow{
    background:#d3d3d3;
    font-weight:bold;
}

</style>
</head>

<body>

<div class="wrapper">

<h1>Statistiky týmů</h1>

<div class="controls">

<select id="teamSelect">
<option value="">Vyber tým</option>
<option>HC Sparta Praha (P)</option>
<option>HC Sparta Praha (K)</option>
<option>HC Bílí Tygři Liberec (P)</option>
<option>HC Bílí Tygři Liberec (K)</option>
<option>HC Dynamo Pardubice (P)</option>
<option>HC Dynamo Pardubice (K)</option>
<option>HC Chemopetrol Litvínov (P)</option>
<option>HC Chemopetrol Litvínov (K)</option>
<option>HC Geus Okna Kladno (P)</option>
<option>HC Geus Okna Kladno (K)</option>
<option>HC Motor České Budějovice (P)</option>
<option>HC Motor České Budějovice (K)</option>
<option>HC Energie Karlovy Vary (P)</option>
<option>HC Energie Karlovy Vary (K)</option>
<option>HC Oceláři Třinec (P)</option>
<option>HC Oceláři Třinec (K)</option>
</select>

<select id="categorySelect">
<option value="">Všechny kategorie</option>
<option>Extraliga - základní část</option>
<option>Extraliga - Play off</option>
<option>OH</option>
</select>

<button onclick="loadTeamStats()">Zobrazit statistiky</button>

</div>

<div class="tableWrap">

<table id="teamStats" style="display:none">
<thead>
<tr>
<th>Zápasy</th>
<th>Výhry</th>
<th>Prohry</th>
<th>Góly vstř.</th>
<th>Góly ink.</th>
<th>Střely</th>
<th>Hity</th>
<th>Vhazování</th>
<th>Čas v útoku</th>
<th>Průměr čas v útoku</th>
<th>Přesilovky</th>
<th>Oslabení</th>
</tr>
</thead>
<tbody>
<tr class="summaryRow" id="summaryRow"></tr>
</tbody>
</table>

</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyD0jDnVNHZAs83g6FGwQT_nOpOCyT4NTNU",
  authDomain: "statistiky-6310a.firebaseapp.com",
  projectId: "statistiky-6310a",
  storageBucket: "statistiky-6310a.appspot.com",
  messagingSenderId: "1023222901562",
  appId: "1:1023222901562:web:522ee763e27aa08a8b7e03"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.db=db;
window.getDocs=getDocs;
window.collection=collection;

</script>

<script>

function timeToSeconds(t){
    if(!t || !t.includes(":")) return 0;
    const parts = t.split(":");
    return Number(parts[0])*60 + Number(parts[1]);
}

function secondsToTime(sec){
    const m = Math.floor(sec/60);
    const s = sec%60;
    return m + ":" + String(s).padStart(2,"0");
}

function parsePK(value){
    if(!value || !value.includes("/")) return {ga:0, pk:0};
    const parts=value.split("/");
    return {
        ga:Number(parts[0]),
        pk:Number(parts[1])
    };
}

async function loadTeamStats(){

    const team=document.getElementById("teamSelect").value;
    const category=document.getElementById("categorySelect").value;

    if(!team) return;

    let games=0,wins=0,losses=0;
    let goalsFor=0,goalsAgainst=0;
    let shots=0,hits=0,faceoffs=0;
    let attackTime=0;
    let pp=0;
    let pkGoals=0;
    let pkTotal=0;

    const snapshot=await getDocs(collection(db,"zapasy"));

    snapshot.forEach(docSnap=>{

        const m=docSnap.data();

        if(m.homeTeam!==team && m.awayTeam!==team) return;
        if(category && m.category!==category) return;

        games++;

        const awayGoals =
            Number(m.stats[6])+Number(m.stats[7])+Number(m.stats[8]);

        const homeGoals =
            Number(m.stats[16])+Number(m.stats[17])+Number(m.stats[18]);

        const isHome = m.homeTeam===team;

        const gf = isHome ? homeGoals : awayGoals;
        const ga = isHome ? awayGoals : homeGoals;

        goalsFor+=gf;
        goalsAgainst+=ga;

        if(gf>ga) wins++;
        else losses++;

        shots+=Number(isHome ? m.stats[10] : m.stats[0]);
        hits+=Number(isHome ? m.stats[11] : m.stats[1]);
        faceoffs+=Number(isHome ? m.stats[12] : m.stats[2]);

        attackTime+=timeToSeconds(isHome ? m.stats[13] : m.stats[3]);

        pp+=Number(isHome ? m.stats[14] : m.stats[4]);

        const parsed=parsePK(isHome ? m.stats[15] : m.stats[5]);
        pkGoals+=parsed.ga;
        pkTotal+=parsed.pk;

    });

    const avgAttack = games>0
        ? secondsToTime(Math.floor(attackTime/games))
        : "0:00";

    document.getElementById("summaryRow").innerHTML=`
        <td>${games}</td>
        <td>${wins}</td>
        <td>${losses}</td>
        <td>${goalsFor}</td>
        <td>${goalsAgainst}</td>
        <td>${shots}</td>
        <td>${hits}</td>
        <td>${faceoffs}</td>
        <td>${secondsToTime(attackTime)}</td>
        <td>${avgAttack}</td>
        <td>${pp}</td>
        <td>${pkGoals}/${pkTotal}</td>
    `;

    document.getElementById("teamStats").style.display="table";
}

</script>

</body>
</html>
