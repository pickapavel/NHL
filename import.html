<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>Statistiky zápasů</title>

<style>
body{margin:0;font-family:Arial;background:#f2f2f2}
.wrapper{max-width:1200px;margin:0 auto;background:white;padding:30px}
table{border-collapse:collapse;width:100%;margin-top:20px}
th,td{border:1px solid #999;padding:6px 8px;text-align:center}
th{background:#cfe8f7}
.left{text-align:left}
.filters{margin-bottom:15px;padding:10px;background:#eef6fb}
button{padding:6px 10px}
dialog{padding:20px}
.summary{margin-top:15px;font-weight:bold}
</style>
</head>

<body>
<div class="wrapper">

<h1>Statistiky zápasů</h1>

<!-- FILTRY -->
<div class="filters">
Hráč:
<select id="filterPlayer">
<option value="">Vše</option>
<option>Pici</option>
<option>Kubele</option>
</select>

Tým:
<select id="filterTeam">
<option value="">Vše</option>
</select>

Kategorie:
<select id="filterCategory">
<option value="">Vše</option>
<option>OH</option>
<option>Extraliga - základní část</option>
<option>Extraliga - play off</option>
</select>
</div>

<table id="statsTable">
<thead>
<tr>
<th>Tým</th>
<th>Role</th>
<th>Góly vstř.</th>
<th>Góly ink.</th>
<th>Hity dané</th>
<th>Hity obdrž.</th>
<th>Vhaz. vyhr.</th>
<th>Vhaz. prohr.</th>
<th>Čas v útoku</th>
<th>Čas v obraně</th>
<th>Přesilovky</th>
<th>Využ. PP</th>
<th>OT</th>
<th>Kategorie</th>
<th>Hráč</th>
<th>Akce</th>
</tr>
</thead>

<tbody>

<tr class="matchStart">
<td class="left">HC Geus Okna Kladno</td>
<td>Hosté</td>
<td>30</td><td>18</td>
<td>28</td><td>4</td>
<td>14</td><td>12</td>
<td>11:53</td><td>4:24</td>
<td>1</td><td>1</td>
<td>Ne</td>
<td class="category"></td>
<td class="player"></td>
<td rowspan="2">
<button onclick="openDialog(this)">Aktualizovat</button>
</td>
</tr>

<tr>
<td class="left">HC Oceláři Třinec</td>
<td>Domácí</td>
<td>18</td><td>30</td>
<td>4</td><td>28</td>
<td>12</td><td>14</td>
<td>4:24</td><td>11:53</td>
<td>1</td><td>1</td>
<td>Ne</td>
<td class="category"></td>
<td class="player"></td>
</tr>

</tbody>
</table>

<div class="summary" id="summary"></div>

</div>

<!-- DIALOG -->
<dialog id="editDialog">
<h3>Aktualizace zápasu</h3>

Kategorie:<br>
<select id="dialogCategory">
<option>OH</option>
<option>Extraliga - základní část</option>
<option>Extraliga - play off</option>
</select><br><br>

Tým (hráč):<br>
<select id="dialogPlayer">
<option>Kubele</option>
<option>Pici</option>
</select><br><br>

<button onclick="saveDialog()">Uložit</button>
<button onclick="editDialog.close()">Zavřít</button>
</dialog>

<script>

const tbody=document.querySelector("#statsTable tbody");
const dialog=document.getElementById("editDialog");

let editedRow=null;

/* OTEVŘENÍ DIALOGU */
function openDialog(btn){
  editedRow=btn.closest("tr");
  dialog.showModal();
}

/* ULOŽENÍ */
function saveDialog(){

  const category=document.getElementById("dialogCategory").value;
  const player=document.getElementById("dialogPlayer").value;
  const secondPlayer = player==="Pici" ? "Kubele" : "Pici";

  const row1=editedRow;
  const row2=editedRow.nextElementSibling;

  row1.querySelector(".category").innerText=category;
  row2.querySelector(".category").innerText=category;

  row1.querySelector(".player").innerText=player;
  row2.querySelector(".player").innerText=secondPlayer;

  dialog.close();
  applyFilters();
}

/* FILTRY */

const filterPlayer=document.getElementById("filterPlayer");
const filterTeam=document.getElementById("filterTeam");
const filterCategory=document.getElementById("filterCategory");

function fillTeams(){
  const set=new Set();
  [...tbody.rows].forEach(r=>set.add(r.cells[0].innerText));
  set.forEach(t=>{
    const o=document.createElement("option");
    o.textContent=t;
    filterTeam.appendChild(o);
  });
}
fillTeams();

function applyFilters(){

  let games=0,goals=0;

  for(let i=0;i<tbody.rows.length;i+=2){

    const r1=tbody.rows[i];
    const r2=tbody.rows[i+1];

    const team=r1.cells[0].innerText;
    const player=r1.cells[14].innerText;
    const category=r1.cells[13].innerText;

    let show=true;

    if(filterPlayer.value && player!==filterPlayer.value) show=false;
    if(filterTeam.value && team!==filterTeam.value) show=false;
    if(filterCategory.value && category!==filterCategory.value) show=false;

    r1.style.display=show?"":"none";
    r2.style.display=show?"":"none";

    if(show){
      games++;
      goals+=parseInt(r1.cells[2].innerText)||0;
    }
  }

  document.getElementById("summary").innerText=
    "Zápasy: "+games+" | Góly: "+goals;
}

filterPlayer.onchange=applyFilters;
filterTeam.onchange=applyFilters;
filterCategory.onchange=applyFilters;

applyFilters();

</script>

</body>
</html>
