<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Statistiky zápasu</title>

<style>

*{box-sizing:border-box}

body{
    font-family:Arial;
    background:#f2f2f2;
    margin:0;
}

.wrapper{
    max-width:1200px;
    margin:auto;
    padding:20px;
    background:white;
}

.controls{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    margin-bottom:20px;
}

.controls > *{
    flex:1;
    min-width:160px;
    padding:8px;
}

.tableWrap{overflow-x:auto;}

table{
    border-collapse:collapse;
    width:100%;
    min-width:650px;
}

th,td{
    border:1px solid #999;
    padding:8px;
    text-align:left;
}

th{
    background:black;
    color:#ffff00;
    font-weight:bold;
}

.deleteBtn{
    background:#d9534f;
    color:white;
    border:none;
    padding:6px 10px;
    cursor:pointer;
}

.activeMatch{
    background:#d3d3d3 !important;
}

.filterBar{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin-bottom:10px;
}

@media (max-width:700px){
    .controls > *,
    .filterBar > *{flex:100%;}
}

</style>
</head>

<body>

<div class="wrapper">

<h1>Statistiky zápasu</h1>

<div class="controls">

<input type="file" id="fileInput" accept=".txt">

<select id="category">
<option value="" selected disabled>Kategorie</option>
<option>Extraliga - základní část</option>
<option>Extraliga - Play off</option>
<option>OH</option>
</select>

<select id="homeTeam">
<option value="" selected disabled>Domácí tým</option>

<option value="HC Sparta Praha (P)">Sparta (P)</option>
<option value="HC Sparta Praha (K)">Sparta (K)</option>

<option value="HC Bílí Tygři Liberec (P)">Liberec (P)</option>
<option value="HC Bílí Tygři Liberec (K)">Liberec (K)</option>

<option value="HC Dynamo Pardubice (P)">Pardubice (P)</option>
<option value="HC Dynamo Pardubice (K)">Pardubice (K)</option>

<option value="HC Chemopetrol Litvínov (P)">Litvínov (P)</option>
<option value="HC Chemopetrol Litvínov (K)">Litvínov (K)</option>

<option value="HC Geus Okna Kladno (P)">Kladno (P)</option>
<option value="HC Geus Okna Kladno (K)">Kladno (K)</option>

<option value="HC Motor České Budějovice (P)">Motor (P)</option>
<option value="HC Motor České Budějovice (K)">Motor (K)</option>

<option value="HC Energie Karlovy Vary (P)">Karlovy Vary (P)</option>
<option value="HC Energie Karlovy Vary (K)">Karlovy Vary (K)</option>

<option value="HC Oceláři Třinec (P)">Třinec (P)</option>
<option value="HC Oceláři Třinec (K)">Třinec (K)</option>

</select>

<select id="awayTeam">
<option value="" selected disabled>Hostující tým</option>

<option value="HC Sparta Praha (P)">Sparta (P)</option>
<option value="HC Sparta Praha (K)">Sparta (K)</option>

<option value="HC Bílí Tygři Liberec (P)">Liberec (P)</option>
<option value="HC Bílí Tygři Liberec (K)">Liberec (K)</option>

<option value="HC Dynamo Pardubice (P)">Pardubice (P)</option>
<option value="HC Dynamo Pardubice (K)">Pardubice (K)</option>

<option value="HC Chemopetrol Litvínov (P)">Litvínov (P)</option>
<option value="HC Chemopetrol Litvínov (K)">Litvínov (K)</option>

<option value="HC Geus Okna Kladno (P)">Kladno (P)</option>
<option value="HC Geus Okna Kladno (K)">Kladno (K)</option>

<option value="HC Motor České Budějovice (P)">Motor (P)</option>
<option value="HC Motor České Budějovice (K)">Motor (K)</option>

<option value="HC Energie Karlovy Vary (P)">Karlovy Vary (P)</option>
<option value="HC Energie Karlovy Vary (K)">Karlovy Vary (K)</option>

<option value="HC Oceláři Třinec (P)">Třinec (P)</option>
<option value="HC Oceláři Třinec (K)">Třinec (K)</option>

</select>

<button onclick="saveMatch()">Uložit zápas</button>

</div>

<h2>Historie zápasů</h2>

<div class="filterBar">
<select id="filterCategory">
<option value="">Všechny kategorie</option>
<option>Extraliga - základní část</option>
<option>Extraliga - Play off</option>
<option>OH</option>
</select>

<button onclick="applyFilter()">Filtrovat</button>
<button onclick="resetFilter()">Zobrazit vše</button>
</div>

<div class="tableWrap">
<table id="history">
<thead>
<tr>
<th>Datum</th>
<th>Kategorie</th>
<th>Domácí</th>
<th>Hosté</th>
<th>Skóre</th>
<th>Smazat</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<h2>Detail zápasu</h2>

<div class="tableWrap">
<table id="detailTable" style="display:none">
<tr><th>Statistika</th><th>Domácí</th><th>Hosté</th></tr>
<tr><td>Střely</td><td id="ds10"></td><td id="ds0"></td></tr>
<tr><td>Hity</td><td id="ds11"></td><td id="ds1"></td></tr>
<tr><td>Vhazování</td><td id="ds12"></td><td id="ds2"></td></tr>
<tr><td>Čas v útoku</td><td id="ds13"></td><td id="ds3"></td></tr>
<tr><td>Přesilovky</td><td id="ds14"></td><td id="ds4"></td></tr>
<tr><td>Oslabení</td><td id="ds15"></td><td id="ds5"></td></tr>
<tr><td>Góly 1. tř.</td><td id="ds16"></td><td id="ds6"></td></tr>
<tr><td>Góly 2. tř.</td><td id="ds17"></td><td id="ds7"></td></tr>
<tr><td>Góly 3. tř.</td><td id="ds18"></td><td id="ds8"></td></tr>
</table>
</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyD0jDnVNHZAs83g6FGwQT_nOpOCyT4NTNU",
  authDomain: "statistiky-6310a.firebaseapp.com",
  projectId: "statistiky-6310a",
  storageBucket: "statistiky-6310a.appspot.com",
  messagingSenderId: "1023222901562",
  appId: "1:1023222901562:web:522ee763e27aa08a8b7e03"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let loadedLines=[];
let allMatches=[];

window.addEventListener("load", loadMatches);

function calculateScore(stats){

    let awayGoals =
        Number(stats[6])+Number(stats[7])+Number(stats[8]);

    let homeGoals =
        Number(stats[16])+Number(stats[17])+Number(stats[18]);

    if(stats[9]==="11") awayGoals++;
    if(stats[19]==="11") homeGoals++;

    let suffix="";

    if(stats[20]==="1" || stats[20]==="2"){
        suffix=" SN";
    } else if(
        (stats[9]==="11" || stats[19]==="11") &&
        Math.abs(homeGoals-awayGoals)===1
    ){
        suffix=" OT";
    }

    return homeGoals+" : "+awayGoals+suffix;
}

async function loadMatches(){
    allMatches=[];
    const q=query(collection(db,"zapasy"),orderBy("created","desc"));
    const snapshot=await getDocs(q);

    snapshot.forEach(docSnap=>{
        allMatches.push({id:docSnap.id,...docSnap.data()});
    });

    renderMatches();
}

function renderMatches(){
    const tbody=document.querySelector("#history tbody");
    tbody.innerHTML="";

    allMatches.forEach(m=>{
        const tr=document.createElement("tr");

        tr.innerHTML=`
        <td>${new Date(m.created).toLocaleDateString()}</td>
        <td>${m.category}</td>
        <td>${m.homeTeam}</td>
        <td>${m.awayTeam}</td>
        <td>${calculateScore(m.stats)}</td>
        <td><button class="deleteBtn">Smazat</button></td>
        `;

        tbody.appendChild(tr);
    });
}

</script>

</body>
</html>
