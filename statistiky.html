<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Statistiky z√°pasu</title>

<style>

*{box-sizing:border-box}

body{
    font-family:Arial;
    background:#f2f2f2;
    margin:0;
}

.wrapper{
    max-width:1200px;
    margin:auto;
    padding:20px;
    background:white;
}

.controls{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    margin-bottom:20px;
}

.controls > *{
    flex:1;
    min-width:160px;
    padding:8px;
}

.tableWrap{
    overflow-x:auto;
}

table{
    border-collapse:collapse;
    width:100%;
    min-width:650px;
}

th{
    border:1px solid #999;
    padding:8px;
    text-align:center;
}

/* üëá zmƒõna jen tady */
td{
    border:1px solid #999;
    padding:8px;
    text-align:left;
}

/* HLAVIƒåKY TABULEK */
th{
    background:black;
    color:#ffff00;
    font-weight:bold;
}

.deleteBtn{
    background:#d9534f;
    color:white;
    border:none;
    padding:6px 10px;
    cursor:pointer;
}

.activeMatch{
    background:#d3d3d3; !important;
    color:black;
}

.filterBar{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin-bottom:10px;
}

/* ===== MOBIL ===== */
@media (max-width:700px){

    .controls > *,
    .filterBar > *{
        flex:100%;
    }

    .filterBar select,
    .filterBar button{
        font-size:18px;
        padding:14px;
        min-height:48px;
    }
}

</style>
</head>

<body>

<div class="wrapper">

<h1>Statistiky z√°pasu</h1>

<div class="controls">

<input type="file" id="fileInput" accept=".txt">

<select id="category">
<option value="" selected disabled>Kategorie</option>
<option>Extraliga - z√°kladn√≠ ƒç√°st</option>
<option>Extraliga - Play off</option>
<option>OH</option>
</select>

<select id="homeTeam">
<option value="" selected disabled>Dom√°c√≠ t√Ωm</option>
<option>HC Sparta Praha (Pici)</option>
<option>HC Sparta Praha (Kubele)</option>
<option>HC B√≠l√≠ Tyg≈ôi Liberec (Pici)</option>
<option>HC B√≠l√≠ Tyg≈ôi Liberec (Kubele)</option>
<option>HC Dynamo Pardubice (Pici)</option>
<option>HC Dynamo Pardubice (Kubele)</option>
<option>HC Chemopetrol Litv√≠nov (Pici)</option>
<option>HC Chemopetrol Litv√≠nov (Kubele)</option>
<option>HC Geus Okna Kladno (Pici)</option>
<option>HC Geus Okna Kladno (Kubele)</option>
<option>HC Motor ƒåesk√© Budƒõjovice (Pici)</option>
<option>HC Motor ƒåesk√© Budƒõjovice (Kubele)</option>
<option>HC Energie Karlovy Vary (Pici)</option>
<option>HC Energie Karlovy Vary (Kubele)</option>
<option>HC Ocel√°≈ôi T≈ôinec (Pici)</option>
<option>HC Ocel√°≈ôi T≈ôinec (Kubele)</option>
</select>

<select id="awayTeam">
<option value="" selected disabled>Hostuj√≠c√≠ t√Ωm</option>
<option>HC Sparta Praha (Pici)</option>
<option>HC Sparta Praha (Kubele)</option>
<option>HC B√≠l√≠ Tyg≈ôi Liberec (Pici)</option>
<option>HC B√≠l√≠ Tyg≈ôi Liberec (Kubele)</option>
<option>HC Dynamo Pardubice (Pici)</option>
<option>HC Dynamo Pardubice (Kubele)</option>
<option>HC Chemopetrol Litv√≠nov (Pici)</option>
<option>HC Chemopetrol Litv√≠nov (Kubele)</option>
<option>HC Geus Okna Kladno (Pici)</option>
<option>HC Geus Okna Kladno (Kubele)</option>
<option>HC Motor ƒåesk√© Budƒõjovice (Pici)</option>
<option>HC Motor ƒåesk√© Budƒõjovice (Kubele)</option>
<option>HC Energie Karlovy Vary (Pici)</option>
<option>HC Energie Karlovy Vary (Kubele)</option>
<option>HC Ocel√°≈ôi T≈ôinec (Pici)</option>
<option>HC Ocel√°≈ôi T≈ôinec (Kubele)</option>
</select>

<button onclick="saveMatch()">Ulo≈æit z√°pas</button>

</div>

<h2>Historie z√°pas≈Ø</h2>

<div class="filterBar">

<select id="filterCategory">
<option value="">V≈°echny kategorie</option>
<option>Extraliga - z√°kladn√≠ ƒç√°st</option>
<option>Extraliga - Play off</option>
<option>OH</option>
</select>

<button onclick="applyFilter()">Filtrovat</button>
<button onclick="resetFilter()">Zobrazit v≈°e</button>

</div>

<div class="tableWrap">
<table id="history">
<thead>
<tr>
<th>Datum</th>
<th>Kategorie</th>
<th>Host√©</th>
<th>Dom√°c√≠</th>
<th>Sk√≥re</th>
<th>Smazat</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<h2>Detail z√°pasu</h2>

<div class="tableWrap">
<table id="detailTable" style="display:none">
<tr><th>Statistika</th><th>Host√©</th><th>Dom√°c√≠</th></tr>
<tr><td>St≈ôely</td><td id="ds0"></td><td id="ds10"></td></tr>
<tr><td>Hity</td><td id="ds1"></td><td id="ds11"></td></tr>
<tr><td>Vhazov√°n√≠</td><td id="ds2"></td><td id="ds12"></td></tr>
<tr><td>ƒåas v √∫toku</td><td id="ds3"></td><td id="ds13"></td></tr>
<tr><td>P≈ôesilovky</td><td id="ds4"></td><td id="ds14"></td></tr>
<tr><td>Oslaben√≠</td><td id="ds5"></td><td id="ds15"></td></tr>
<tr><td>G√≥ly 1. t≈ô.</td><td id="ds6"></td><td id="ds16"></td></tr>
<tr><td>G√≥ly 2. t≈ô.</td><td id="ds7"></td><td id="ds17"></td></tr>
<tr><td>G√≥ly 3. t≈ô.</td><td id="ds8"></td><td id="ds18"></td></tr>
<tr><td>Prodlou≈æen√≠</td><td id="ds9"></td><td id="ds19"></td></tr>
</table>
</div>

</div>

<!-- JS ƒç√°st z≈Øst√°v√° √∫plnƒõ stejn√° -->
<!-- (je zde cel√°, jen kv≈Øli d√©lce ji znovu nevysvƒõtluju, ale je kompletn√≠) -->

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyD0jDnVNHZAs83g6FGwQT_nOpOCyT4NTNU",
  authDomain: "statistiky-6310a.firebaseapp.com",
  projectId: "statistiky-6310a",
  storageBucket: "statistiky-6310a.appspot.com",
  messagingSenderId: "1023222901562",
  appId: "1:1023222901562:web:522ee763e27aa08a8b7e03"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.db=db;
window.addDoc=addDoc;
window.collection=collection;
window.getDocs=getDocs;
window.deleteDoc=deleteDoc;
window.doc=doc;
window.query=query;
window.orderBy=orderBy;

window.addEventListener("load", loadMatches);
</script>

<script>

let loadedLines=[];
let activeRow=null;
let allMatches=[];

function applyFilter(){
    const cat=document.getElementById("filterCategory").value;
    renderMatches(cat);
}

function resetFilter(){
    filterCategory.value="";
    renderMatches();
}

document.getElementById("fileInput").addEventListener("change", e=>{
    const reader=new FileReader();
    reader.onload=ev=>{
        loadedLines=ev.target.result.split(/\r?\n/)
        .map(l=>l.trim()).filter(l=>l!=="");
    };
    reader.readAsText(e.target.files[0]);
});

async function saveMatch(){

    if(!category.value || !homeTeam.value || !awayTeam.value){
        alert("Vyber kategorii a oba t√Ωmy.");
        return;
    }

    if(loadedLines.length<20){
        alert("Nejprve nahraj zapas.txt");
        return;
    }

    await addDoc(collection(db,"zapasy"),{
        category:category.value,
        homeTeam:homeTeam.value,
        awayTeam:awayTeam.value,
        stats:loadedLines,
        created:Date.now()
    });

    loadMatches();
}

async function deleteMatch(id){

    const password = prompt("Zadej heslo pro smaz√°n√≠ z√°pasu:");

    if(password !== "Lokomotiva"){
        alert("≈†patn√© heslo.");
        return;
    }

    if(!confirm("Opravdu smazat z√°pas?")) return;

    await deleteDoc(doc(db,"zapasy",id));
    loadMatches();
}

async function loadMatches(){

    allMatches=[];
    const q=query(collection(db,"zapasy"),orderBy("created","desc"));
    const snapshot=await getDocs(q);

    snapshot.forEach(docSnap=>{
        allMatches.push({id:docSnap.id,...docSnap.data()});
    });

    renderMatches();
}

function renderMatches(filterCategory=""){

    const tbody=document.querySelector("#history tbody");
    tbody.innerHTML="";

    let first=true;

    allMatches.forEach(m=>{

        if(filterCategory && m.category!==filterCategory) return;

        const awayGoals=
            Number(m.stats[6])+Number(m.stats[7])+Number(m.stats[8]);

        const homeGoals=
            Number(m.stats[16])+Number(m.stats[17])+Number(m.stats[18]);

        const tr=document.createElement("tr");

        tr.innerHTML=`
        <td>${new Date(m.created).toLocaleDateString()}</td>
        <td>${m.category}</td>
        <td>${m.awayTeam}</td>
        <td>${m.homeTeam}</td>
        <td>${awayGoals} : ${homeGoals}</td>
        <td><button class="deleteBtn">Smazat</button></td>
        `;

        tr.onclick=()=>{
            setActiveRow(tr);
            showDetail(m.stats);
        };

        tr.querySelector(".deleteBtn").onclick=(e)=>{
            e.stopPropagation();
            deleteMatch(m.id);
        };

        tbody.appendChild(tr);

        if(first){
            setActiveRow(tr);
            showDetail(m.stats);
            first=false;
        }
    });
}

function setActiveRow(row){
    if(activeRow) activeRow.classList.remove("activeMatch");
    activeRow=row;
    activeRow.classList.add("activeMatch");
}

function showDetail(stats){
    for(let i=0;i<20;i++){
        document.getElementById("ds"+i).innerText=stats[i];
    }
    document.getElementById("detailTable").style.display="table";
}

</script>

</body>
</html>
