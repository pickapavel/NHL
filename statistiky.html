<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>Statistiky zápasu</title>

<style>
body{font-family:Arial;background:#f2f2f2;margin:0}
.wrapper{max-width:1100px;margin:40px auto;background:white;padding:30px}
.controls{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:20px}
table{border-collapse:collapse;width:100%;margin-top:20px}
th,td{border:1px solid #999;padding:8px;text-align:center}
th{background:#cfe8f7}
button{padding:8px 14px}
h2{margin-top:40px}
</style>
</head>

<body>

<div class="wrapper">

<h1>Statistiky zápasu</h1>

<div class="controls">

<input type="file" id="fileInput" accept=".txt">

<select id="category">
<option>Extraliga - základní část</option>
<option>Extraliga - Play off</option>
<option>OH</option>
</select>

<select id="player">
<option>Pici</option>
<option>Kubele</option>
</select>

<select id="homeTeam">
<option>HC Sparta Praha</option>
<option>HC Bílí Tygři Liberec</option>
<option>HC Dynamo Pardubice</option>
<option>HC Chemopetrol Litvínov</option>
<option>HC Geus Okna Kladno</option>
<option>HC Motor České Budějovice</option>
<option>HC Energie Karlovy Vary</option>
<option>HC Oceláři Třinec</option>
</select>

<select id="awayTeam">
<option>HC Sparta Praha</option>
<option>HC Bílí Tygři Liberec</option>
<option>HC Dynamo Pardubice</option>
<option>HC Chemopetrol Litvínov</option>
<option>HC Geus Okna Kladno</option>
<option>HC Motor České Budějovice</option>
<option>HC Energie Karlovy Vary</option>
<option>HC Oceláři Třinec</option>
</select>

<button onclick="saveMatch()">Uložit zápas</button>

</div>

<h2>Historie zápasů</h2>

<table id="history">
<thead>
<tr>
<th>Datum</th>
<th>Kategorie</th>
<th>Hráč</th>
<th>Hosté</th>
<th>Domácí</th>
<th>Skóre</th>
</tr>
</thead>
<tbody></tbody>
</table>

</div>

<!-- FIREBASE -->
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, orderBy } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyD0jDnVNHZAs83g6FGwQT_nOpOCyT4NTNU",
  authDomain: "statistiky-6310a.firebaseapp.com",
  projectId: "statistiky-6310a",
  storageBucket: "statistiky-6310a.appspot.com",
  messagingSenderId: "1023222901562",
  appId: "1:1023222901562:web:522ee763e27aa08a8b7e03"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.db = db;
window.addDoc = addDoc;
window.collection = collection;
window.getDocs = getDocs;
window.query = query;
window.orderBy = orderBy;

loadMatches();

</script>

<script>

let loadedLines = [];

/* NAČTENÍ TXT */
document.getElementById("fileInput").addEventListener("change", e => {

    const reader = new FileReader();

    reader.onload = ev => {
        loadedLines = ev.target.result
            .split(/\r?\n/)
            .map(l=>l.trim())
            .filter(l=>l!=="");
    };

    reader.readAsText(e.target.files[0]);
});

/* ULOŽENÍ */
async function saveMatch(){

    if(loadedLines.length < 20){
        alert("Nejprve nahraj zapas.txt");
        return;
    }

    await addDoc(collection(db,"zapasy"),{
        category: category.value,
        player: player.value,
        homeTeam: homeTeam.value,
        awayTeam: awayTeam.value,
        stats: loadedLines,
        created: Date.now()
    });

    alert("Zápas uložen!");
    loadMatches();
}

/* NAČTENÍ HISTORIE */
async function loadMatches(){

    const tbody = document.querySelector("#history tbody");
    tbody.innerHTML="";

    const q = query(collection(db,"zapasy"), orderBy("created","desc"));
    const snapshot = await getDocs(q);

    snapshot.forEach(doc=>{

        const d = doc.data();

        const awayGoals =
            Number(d.stats[6]) +
            Number(d.stats[7]) +
            Number(d.stats[8]);

        const homeGoals =
            Number(d.stats[16]) +
            Number(d.stats[17]) +
            Number(d.stats[18]);

        const tr=document.createElement("tr");

        tr.innerHTML=`
        <td>${new Date(d.created).toLocaleDateString()}</td>
        <td>${d.category}</td>
        <td>${d.player}</td>
        <td>${d.awayTeam}</td>
        <td>${d.homeTeam}</td>
        <td>${awayGoals} : ${homeGoals}</td>
        `;

        tbody.appendChild(tr);
    });
}

</script>

</body>
</html>
